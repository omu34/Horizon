{% comment %}
  Section: Hero with Testimonials
  Description: Custom section based on "Jan to Dev" assessment requirements.
  Includes: 2-column hero, gradient text, specific image styling, and a testimonial slider block system.
{% endcomment %}

{{ 'section-hero-testimonial.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Dynamic Color Settings */
  #shopify-section-{{ section.id }} .ht-container {
    background: {{ section.settings.bg_gradient }};
  }

  #shopify-section-{{ section.id }} .ht-heading {
    background: linear-gradient(90deg, {{ section.settings.text_gradient_start }}, {{ section.settings.text_gradient_end }});
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  #shopify-section-{{ section.id }} .ht-button {
    background-color: {{ section.settings.btn_color }};
    color: {{ section.settings.btn_text_color }};
  }
{%- endstyle -%}

<div class="ht-wrapper section-{{ section.id }}-padding">
  <div class="ht-container page-width">
    
    <div class="ht-grid">
      <div class="ht-content">
        <h2 class="ht-heading">{{ section.settings.heading }}</h2>
        <div class="ht-description">
          {{ section.settings.description }}
        </div>
        
        <div class="ht-actions">
          <a href="{{ section.settings.btn_link }}" class="ht-button">
            {{ section.settings.btn_label }}
          </a>
          {% if section.settings.trust_text != blank %}
            <p class="ht-trust-text">{{ section.settings.trust_text }}</p>
          {% endif %}
        </div>
      </div>

      <div class="ht-image-wrapper">
        {% if section.settings.image != blank %}
          {{ section.settings.image | image_url: width: 1000 | image_tag: 
            loading: 'lazy', 
            class: 'ht-main-image', 
            sizes: '(min-width: 750px) 50vw, 100vw' 
          }}
        {% else %}
          {{ 'lifestyle-1' | placeholder_svg_tag: 'ht-placeholder' }}
        {% endif %}
      </div>
    </div>

    {% if section.blocks.size > 0 %}
      <div class="ht-divider"></div>
      
      <div class="ht-slider-container" data-slider-id="{{ section.id }}">
        <div class="ht-slides-wrapper">
          {% for block in section.blocks %}
            <div class="ht-slide {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
              <div class="ht-quote">
                &ldquo;{{ block.settings.quote }}&rdquo;
              </div>
              
              <div class="ht-meta">
                <div class="ht-stars">
                  {% for i in (1..5) %}
                    <span class="star">★</span>
                  {% endfor %}
                </div>
                <span class="ht-author-separator">✦</span>
                <span class="ht-author">{{ block.settings.author }}</span>
                <span class="ht-author-separator">✦</span>
                <span class="ht-date">{{ block.settings.date }}</span>
              </div>
            </div>
          {% endfor %}
        </div>

        {% if section.blocks.size > 1 %}
          <div class="ht-controls">
            <div class="ht-dots">
              {% for block in section.blocks %}
                <button class="ht-dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}" aria-label="Go to slide {{ forloop.index }}"></button>
              {% endfor %}
            </div>
            <button class="ht-next-btn" aria-label="Next slide">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
        {% endif %}
      </div>
    {% endif %}

  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const container = document.querySelector('[data-slider-id="{{ section.id }}"]');
    if (!container) return;

    const slides = container.querySelectorAll('.ht-slide');
    const dots = container.querySelectorAll('.ht-dot');
    const nextBtn = container.querySelector('.ht-next-btn');
    let currentIndex = 0;

    function showSlide(index) {
      // Handle wrapping
      if (index >= slides.length) index = 0;
      if (index < 0) index = slides.length - 1;
      
      currentIndex = index;

      // Update Slides
      slides.forEach(slide => slide.classList.remove('active'));
      slides[currentIndex].classList.add('active');

      // Update Dots
      dots.forEach(dot => dot.classList.remove('active'));
      if(dots[currentIndex]) dots[currentIndex].classList.add('active');
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', () => showSlide(currentIndex + 1));
    }

    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        const index = parseInt(dot.getAttribute('data-index'));
        showSlide(index);
      });
    });
  });
</script>

{% schema %}
{
  "name": "Hero with Testimonials",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "color_background",
      "id": "bg_gradient",
      "label": "Background Gradient",
      "default": "linear-gradient(180deg, #FFFFFF 0%, #F5F0FF 100%)"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 40
    },
    {
      "type": "header",
      "content": "Hero Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Lorem ipsum dolor sit amet"
    },
    {
      "type": "color",
      "id": "text_gradient_start",
      "label": "Heading Gradient Start",
      "default": "#9333ea"
    },
    {
      "type": "color",
      "id": "text_gradient_end",
      "label": "Heading Gradient End",
      "default": "#2563eb"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut.</p>"
    },
    {
      "type": "text",
      "id": "btn_label",
      "label": "Button Label",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "btn_link",
      "label": "Button Link"
    },
    {
      "type": "color",
      "id": "btn_color",
      "label": "Button Background",
      "default": "#6d28d9"
    },
    {
      "type": "color",
      "id": "btn_text_color",
      "label": "Button Text",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "trust_text",
      "label": "Trust Text (Under Button)",
      "default": "Over 100,000+ Happy Customers"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Hero Image"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "text",
          "id": "quote",
          "label": "Quote",
          "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor"
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author Name",
          "default": "Lorem ipsum"
        },
        {
          "type": "text",
          "id": "date",
          "label": "Date",
          "default": "22/09/1996"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero with Testimonials",
      "blocks": [
        {
          "type": "testimonial"
        },
        {
          "type": "testimonial"
        },
        {
          "type": "testimonial"
        }
      ]
    }
  ]
}
{% endschema %}